<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Osxptb-dev] timing &amp; UpTime
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/osxptb-dev/2006-August/index.html" >
   <LINK REL="made" HREF="mailto:osxptb-dev%40lists.berlios.de?Subject=Re%3A%20%5BOsxptb-dev%5D%20timing%20%26%20UpTime&In-Reply-To=%3C44E5E6B0.7010307%40sas.upenn.edu%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000087.html">
   <LINK REL="Next"  HREF="000089.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Osxptb-dev] timing &amp; UpTime</H1>
    <B>Christopher Broussard</B> 
    <A HREF="mailto:osxptb-dev%40lists.berlios.de?Subject=Re%3A%20%5BOsxptb-dev%5D%20timing%20%26%20UpTime&In-Reply-To=%3C44E5E6B0.7010307%40sas.upenn.edu%3E"
       TITLE="[Osxptb-dev] timing &amp; UpTime">chrg at sas.upenn.edu
       </A><BR>
    <I>Fri Aug 18 18:11:28 CEST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="000087.html">[Osxptb-dev] timing &amp; UpTime
</A></li>
        <LI>Next message: <A HREF="000089.html">[Osxptb-dev] timing &amp; UpTime
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#88">[ date ]</a>
              <a href="thread.html#88">[ thread ]</a>
              <a href="subject.html#88">[ subject ]</a>
              <a href="author.html#88">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I changed the processor performance to the highest in the energy savings 
panel, but still no change.  I'm attaching the short script that I've 
been using to test the timing.  If you could test the timing on your 
computer and see if you have similar results that would be awesome.  You 
may have to run it a few times to see the timing blips.

    -Chris-

Mario Kleiner wrote:
&gt;<i> Hmmm. Could you check in system settings all options
</I>&gt;<i> somehow related to energy saving? I dimly remember that the
</I>&gt;<i> processor settings had some switch to switch between
</I>&gt;<i> performance, auto and energy saving or something like that.
</I>&gt;<i>
</I>&gt;<i> Maybe the system enters a low-energy processor sleep mode
</I>&gt;<i> everytime the cpu is idle for a few milliseconds?
</I>&gt;<i>
</I>&gt;<i> Does anything change when changing the WaitSecs() interval,
</I>&gt;<i> down to 1 ms?
</I>&gt;<i>
</I>&gt;<i> On Fri, 18 Aug 2006 11:38:06 -0400
</I>&gt;<i>  Christopher Broussard &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/osxptb-dev">chrg at sas.upenn.edu</A>&gt; wrote:
</I>&gt;<i>   
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>   
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &nbsp;&nbsp;&nbsp; While I don't doubt the accuracy of
</I>&gt;&gt;<i> Flip, my real concern is that
</I>&gt;&gt;<i> my system is pausing after a call to Flip.&nbsp; I also
</I>&gt;&gt;<i> made a short program
</I>&gt;&gt;<i> that does the same thing as TestFlip, but instead uses
</I>&gt;&gt;<i> WaitSecs and I
</I>&gt;&gt;<i> get pretty much identical behavior.&nbsp; I'm going to
</I>&gt;&gt;<i> run this on different
</I>&gt;&gt;<i> machines to see if it's just my hardware, but if it seems
</I>&gt;&gt;<i> to be Matlab
</I>&gt;&gt;<i> going out to lunch for whatever reason, this could be a
</I>&gt;&gt;<i> problem for
</I>&gt;&gt;<i> anyone trying to accurately time their stimulus and not
</I>&gt;&gt;<i> miss any frames.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> &nbsp;&nbsp;&nbsp; -Chris-
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Mario Kleiner wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>   Allen is right, i made an inaccurate statement. The
</I>&gt;&gt;<i> precision of GetSecs itself is as good as on OS-9 on all
</I>&gt;&gt;<i> platforms. All operating systems use a high-res hardware
</I>&gt;&gt;<i> timer. I referred to the fact that there is a small
</I>&gt;&gt;<i> random
</I>&gt;&gt;<i> delay between onset of vertical retrace and Matlab
</I>&gt;&gt;<i> resuming
</I>&gt;&gt;<i> its execution, taking the GetSecs timestamp and such. 
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> When running under realtime priority (Time constraint in
</I>&gt;&gt;<i> OS-X language) this jitter/delay is usually below 1 msec
</I>&gt;&gt;<i> (My machine: 1.6 Ghz single proc G5 roughly 200
</I>&gt;&gt;<i> microseconds.) The update --&gt; sigsetjmp problem is
</I>&gt;&gt;<i> gone in
</I>&gt;&gt;<i> 10.4.7 due to improvements in Darwins kernel locking.
</I>&gt;&gt;<i> However, there are other factors that influence the
</I>&gt;&gt;<i> timing
</I>&gt;&gt;<i> of a non-realtime general purpose system like OS-X and
</I>&gt;&gt;<i> that
</I>&gt;&gt;<i> can only be eliminated/limited by very careful software
</I>&gt;&gt;<i> design and system setup, not by simply calling Priority()
</I>&gt;&gt;<i> (which only tells the scheduler to prioritize execution
</I>&gt;&gt;<i> of
</I>&gt;&gt;<i> Matlab over all other processes). E.g., memory access: If
</I>&gt;&gt;<i> the system runs low on memory and needs to page in/out
</I>&gt;&gt;<i> data
</I>&gt;&gt;<i> of the Matlab process to the swapfile, this will create
</I>&gt;&gt;<i> multi-millisecond random delays. Or if one uses hardware
</I>&gt;&gt;<i> with bad device drivers that introduce latencies and
</I>&gt;&gt;<i> such.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> These, usually very seldom, timing spikes are noticed by
</I>&gt;&gt;<i> a
</I>&gt;&gt;<i> simple GetSecs measurement, but the Screen('Flip')
</I>&gt;&gt;<i> command
</I>&gt;&gt;<i> compensates for such stuff by use of the display
</I>&gt;&gt;<i> rasterbeam
</I>&gt;&gt;<i> position as an additional &quot;video-locked&quot; high precision
</I>&gt;&gt;<i> timesource to correct the internal GetSecs timestamp
</I>&gt;&gt;<i> appropriately. That is why 'Flip' always robustly reports
</I>&gt;&gt;<i> true stimulus onset, whereas the standard Screen('Flip');
</I>&gt;&gt;<i> t=GetSecs() method in FlipTest is affected by such random
</I>&gt;&gt;<i> delays. So 'Flip' tells you about real stimulus onset,
</I>&gt;&gt;<i> the
</I>&gt;&gt;<i> discrepancy between 'Flip' timestamps and timestamps
</I>&gt;&gt;<i> taken
</I>&gt;&gt;<i> with GetSecs tells you something about the timing noise
</I>&gt;&gt;<i> present in the execution of the Matlab code.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> All in all the PTB timing facilities should be at
</I>&gt;&gt;<i> least/more robust and precise than the old PTB's one.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> This all still doesn't solve Christophers problems
</I>&gt;&gt;<i> though.
</I>&gt;&gt;<i> Such a machine as his one should have a much better
</I>&gt;&gt;<i> timing,
</I>&gt;&gt;<i> unless something is screwed.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Sorry for the confusion &amp; best,
</I>&gt;&gt;<i> -mario
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On Fri, 18 Aug 2006 09:43:10 -0400
</I>&gt;&gt;<i>  &quot;Allen W. Ingling&quot; &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/osxptb-dev">allen_ingling at mac.com</A>&gt; wrote:
</I>&gt;&gt;<i>   
</I>&gt;&gt;<i>   
</I>&gt;&gt;<i>     On Aug 18, 2006, at 3:08 AM, Denis Pelli wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     
</I>&gt;&gt;<i>     
</I>&gt;&gt;<i>       dear mario
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> you say below that:
</I>&gt;&gt;<i>       
</I>&gt;&gt;<i>       
</I>&gt;&gt;<i>         The timing that GetSecs returns (as in FlipTest)
</I>&gt;&gt;<i> is
</I>&gt;&gt;<i>         
</I>&gt;&gt;<i>       
</I>&gt;&gt;<i>     
</I>&gt;&gt;<i>     affected by  
</I>&gt;&gt;<i>     
</I>&gt;&gt;<i>     
</I>&gt;&gt;<i>       
</I>&gt;&gt;<i>         operating system scheduling jitter.
</I>&gt;&gt;<i>         
</I>&gt;&gt;<i>       
</I>&gt;&gt;<i>       oh dear. that's disappointing. I wrote GetSecs for
</I>&gt;&gt;<i> OS9.
</I>&gt;&gt;<i>       
</I>&gt;&gt;<i>     
</I>&gt;&gt;<i>     It is based  
</I>&gt;&gt;<i>     
</I>&gt;&gt;<i>     
</I>&gt;&gt;<i>       on a Mac OS9 call, UpTime, that accesses a hardware
</I>&gt;&gt;<i>       
</I>&gt;&gt;<i>     
</I>&gt;&gt;<i>     counter inside  
</I>&gt;&gt;<i>     
</I>&gt;&gt;<i>     
</I>&gt;&gt;<i>       the PowerPC chip. Nothing ever interrupts that
</I>&gt;&gt;<i> counter,
</I>&gt;&gt;<i>       
</I>&gt;&gt;<i>     
</I>&gt;&gt;<i>     so GetSecs  
</I>&gt;&gt;<i>     
</I>&gt;&gt;<i>     
</I>&gt;&gt;<i>       always gives reliable time under OS9. We accessed
</I>&gt;&gt;<i> that
</I>&gt;&gt;<i>       
</I>&gt;&gt;<i>     
</I>&gt;&gt;<i>     count  
</I>&gt;&gt;<i>     
</I>&gt;&gt;<i>     
</I>&gt;&gt;<i>       through the Mac OS UpTime call, but it was my
</I>&gt;&gt;<i>       
</I>&gt;&gt;<i>     
</I>&gt;&gt;<i>     impression that a few  
</I>&gt;&gt;<i>     
</I>&gt;&gt;<i>     
</I>&gt;&gt;<i>       lines of machine code would have done as well.
</I>&gt;&gt;<i>       
</I>&gt;&gt;<i>     
</I>&gt;&gt;<i>     The system scheduler determines when the timer is
</I>&gt;&gt;<i> read.
</I>&gt;&gt;<i>  That is  
</I>&gt;&gt;<i> independent of the precision of the timer itself.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     
</I>&gt;&gt;<i>     
</I>&gt;&gt;<i>       i could understand losing this capability with the
</I>&gt;&gt;<i>       
</I>&gt;&gt;<i>     
</I>&gt;&gt;<i>     Intel processor  
</I>&gt;&gt;<i>     
</I>&gt;&gt;<i>     
</I>&gt;&gt;<i>       since that processor may not have the counter. But
</I>&gt;&gt;<i> it
</I>&gt;&gt;<i>       
</I>&gt;&gt;<i>     
</I>&gt;&gt;<i>     would be my  
</I>&gt;&gt;<i>     
</I>&gt;&gt;<i>     
</I>&gt;&gt;<i>       guess that all the powerpc chips have this counter
</I>&gt;&gt;<i> and
</I>&gt;&gt;<i>       
</I>&gt;&gt;<i>     
</I>&gt;&gt;<i>     it seems a  
</I>&gt;&gt;<i>     
</I>&gt;&gt;<i>     
</I>&gt;&gt;<i>       great shame not to use it. Being able to time
</I>&gt;&gt;<i> things
</I>&gt;&gt;<i>       
</I>&gt;&gt;<i>     
</I>&gt;&gt;<i>     accurately  
</I>&gt;&gt;<i>     
</I>&gt;&gt;<i>     
</I>&gt;&gt;<i>       from a high-level MATLAB program is invaluable. It
</I>&gt;&gt;<i>       
</I>&gt;&gt;<i>     
</I>&gt;&gt;<i>     allows users to  
</I>&gt;&gt;<i>     
</I>&gt;&gt;<i>     
</I>&gt;&gt;<i>       test the timing of everything.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> i googled UpTime (too many false hits) and
</I>&gt;&gt;<i>       
</I>&gt;&gt;<i>     
</I>&gt;&gt;<i>     AbsoluteToNanoseconds  
</I>&gt;&gt;<i>     
</I>&gt;&gt;<i>     
</I>&gt;&gt;<i>       (better) and found many pages devoted to this. It
</I>&gt;&gt;<i>       
</I>&gt;&gt;<i>     
</I>&gt;&gt;<i>     appears to me  
</I>&gt;&gt;<i>     
</I>&gt;&gt;<i>     
</I>&gt;&gt;<i>       that Apple has maintained support for this
</I>&gt;&gt;<i> important
</I>&gt;&gt;<i>       
</I>&gt;&gt;<i>     
</I>&gt;&gt;<i>     call in Mac OS  
</I>&gt;&gt;<i>     
</I>&gt;&gt;<i>     
</I>&gt;&gt;<i>       X. Thus there appears to be no reason for us not to
</I>&gt;&gt;<i>       
</I>&gt;&gt;<i>     
</I>&gt;&gt;<i>     continue using it.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> GetSecs does use the high-precision hardware timer.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     
</I>&gt;&gt;<i>     
</I>&gt;&gt;<i>       However, Mario doesn't say whether the poor
</I>&gt;&gt;<i> performance
</I>&gt;&gt;<i>       
</I>&gt;&gt;<i>     
</I>&gt;&gt;<i>     of GetSecs  
</I>&gt;&gt;<i>     
</I>&gt;&gt;<i>     
</I>&gt;&gt;<i>       is due to switching to a new call, or due to a
</I>&gt;&gt;<i> change
</I>&gt;&gt;<i>       
</I>&gt;&gt;<i>     
</I>&gt;&gt;<i>     in the Apple  
</I>&gt;&gt;<i>     
</I>&gt;&gt;<i>     
</I>&gt;&gt;<i>       implementation of UpTime. It is conceivable that
</I>&gt;&gt;<i> UpTime
</I>&gt;&gt;<i>       
</I>&gt;&gt;<i>     
</I>&gt;&gt;<i>     has been  
</I>&gt;&gt;<i>     
</I>&gt;&gt;<i>     
</I>&gt;&gt;<i>       ruined, but I hope not....
</I>&gt;&gt;<i>       
</I>&gt;&gt;<i>     
</I>&gt;&gt;<i>     There is no problem with the timer.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> As for dealing with the jitter in the Darwin scheduler:
</I>&gt;&gt;<i>  That can be  
</I>&gt;&gt;<i> confined to set bounds.  Look at the parameters of the
</I>&gt;&gt;<i> call which  
</I>&gt;&gt;<i> sets &quot;time constraint priority&quot;.  The limit of jitter is
</I>&gt;&gt;<i> determined  
</I>&gt;&gt;<i> by parameters to that call.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The  &quot;time constraint priority&quot;  setting is reliable
</I>&gt;&gt;<i> except for  
</I>&gt;&gt;<i> problems with the sigsetjmp call in MATLAB setting kernel
</I>&gt;&gt;<i> locks.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> best,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Allen
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> P.S.  I'll be out of town for a few days, so in case
</I>&gt;&gt;<i> there is a  
</I>&gt;&gt;<i> followup discussion, get back to everyone later.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> Osxptb-dev mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/osxptb-dev">Osxptb-dev at lists.berlios.de</A>
</I>&gt;&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/osxptb-dev">https://lists.berlios.de/mailman/listinfo/osxptb-dev</A>
</I>&gt;&gt;<i>     
</I>&gt;&gt;<i>   
</I>&gt;&gt;<i>   
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> Osxptb-dev mailing list
</I>&gt;&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/osxptb-dev">Osxptb-dev at lists.berlios.de</A>
</I>&gt;&gt;<i> <A HREF="https://lists.berlios.de/mailman/listinfo/osxptb-dev">https://lists.berlios.de/mailman/listinfo/osxptb-dev</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>   
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     
</I>&gt;<i>
</I>&gt;<i>   
</I>-------------- next part --------------
An embedded and charset-unspecified text was scrubbed...
Name: timetest.m
URL: &lt;<A HREF="https://lists.berlios.de/pipermail/osxptb-dev/attachments/20060818/6ff6a24c/attachment.ksh">https://lists.berlios.de/pipermail/osxptb-dev/attachments/20060818/6ff6a24c/attachment.ksh</A>&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000087.html">[Osxptb-dev] timing &amp; UpTime
</A></li>
	<LI>Next message: <A HREF="000089.html">[Osxptb-dev] timing &amp; UpTime
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#88">[ date ]</a>
              <a href="thread.html#88">[ thread ]</a>
              <a href="subject.html#88">[ subject ]</a>
              <a href="author.html#88">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/osxptb-dev">More information about the Osxptb-dev
mailing list</a><br>
</body></html>
